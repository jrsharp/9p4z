# 9P L2CAP Server Sample - Size-Optimized Configuration for nRF5340
# Use: west build -b nrf7002dk/nrf5340/cpuapp -DCONF_FILE=prj_nrf_minimal.conf

# Enable 9P support
CONFIG_NINEP=y
CONFIG_NINEP_CLIENT=n
CONFIG_NINEP_SERVER=y
CONFIG_NINEP_TRANSPORT_L2CAP=y

# Message and resource limits (reduced)
CONFIG_NINEP_MAX_MESSAGE_SIZE=4096
CONFIG_NINEP_MAX_FIDS=16
CONFIG_NINEP_MAX_TAGS=8

# L2CAP transport settings (smaller MTU)
CONFIG_NINEP_L2CAP_PSM=0x0009
CONFIG_NINEP_L2CAP_MTU=2048

# Minimal logging
CONFIG_LOG=y
CONFIG_LOG_DEFAULT_LEVEL=2  # Warning level
CONFIG_NINEP_LOG_LEVEL_WRN=y
CONFIG_BT_LOG_LEVEL_WRN=y

# Console only (no shell)
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y

# Heap for dynamic allocation (reduced)
CONFIG_HEAP_MEM_POOL_SIZE=16384

# Networking (minimal - just what L2CAP needs)
CONFIG_NETWORKING=y

# Bluetooth (minimal)
CONFIG_BT=y
CONFIG_BT_HCI=y
CONFIG_BT_SMP=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_DEVICE_NAME="9P Server"
CONFIG_BT_L2CAP_DYNAMIC_CHANNEL=y

# BT settings - reduced buffers
CONFIG_BT_BUF_ACL_RX_SIZE=251
CONFIG_BT_BUF_ACL_TX_SIZE=251
CONFIG_BT_RX_STACK_SIZE=2048

# Size optimizations
CONFIG_SIZE_OPTIMIZATIONS=y
CONFIG_SPEED_OPTIMIZATIONS=n
CONFIG_DEBUG_OPTIMIZATIONS=n

# Reduce stack sizes
CONFIG_MAIN_STACK_SIZE=1536
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=1536
CONFIG_IDLE_STACK_SIZE=512

# Disable unnecessary features
CONFIG_BT_SETTINGS=n
CONFIG_BT_DEVICE_APPEARANCE=0
