# 9P DFU over L2CAP - Minimal Configuration
# Suitable for ZMK keyboards and other BLE devices

# ========== 9P Protocol ==========
CONFIG_NINEP=y
CONFIG_NINEP_SERVER=y
CONFIG_NINEP_CLIENT=n
CONFIG_NINEP_TRANSPORT_L2CAP=y
CONFIG_NINEP_DFU=y
CONFIG_NINEP_GATT_9PIS=y

# Keep message size reasonable for BLE
CONFIG_NINEP_MAX_MESSAGE_SIZE=4096
CONFIG_NINEP_MAX_FIDS=16
CONFIG_NINEP_MAX_TAGS=8

# L2CAP settings - use compliant PSM
CONFIG_NINEP_L2CAP_PSM=0x0080
CONFIG_NINEP_L2CAP_MTU=2048

# ========== Bluetooth ==========
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_DEVICE_NAME="9P DFU"
CONFIG_BT_MAX_CONN=1
CONFIG_BT_L2CAP_DYNAMIC_CHANNEL=y
CONFIG_BT_GATT_DYNAMIC_DB=y

# Security (optional but recommended)
CONFIG_BT_SMP=y
CONFIG_BT_MAX_PAIRED=3

# BLE buffers - sized for DFU transfers
CONFIG_BT_BUF_ACL_RX_SIZE=2048
CONFIG_BT_BUF_ACL_TX_SIZE=2048

# ========== MCUboot / DFU ==========
CONFIG_BOOTLOADER_MCUBOOT=y
CONFIG_IMG_MANAGER=y
CONFIG_STREAM_FLASH=y
CONFIG_IMG_ERASE_PROGRESSIVELY=n

# Flash buffer - trades RAM for speed
CONFIG_IMG_BLOCK_BUF_SIZE=512

# ========== Flash ==========
CONFIG_FLASH=y
CONFIG_FLASH_MAP=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_MPU_ALLOW_FLASH_WRITE=y

# ========== Networking (required for net_buf) ==========
CONFIG_NETWORKING=y

# ========== Memory ==========
# Minimal heap - DFU pre-erases so doesn't need progressive erase heap
CONFIG_HEAP_MEM_POOL_SIZE=16384
CONFIG_MAIN_STACK_SIZE=2048

# Reboot support
CONFIG_REBOOT=y

# ========== Logging ==========
CONFIG_LOG=y
CONFIG_LOG_MODE_MINIMAL=y
CONFIG_NINEP_LOG_LEVEL_INF=y

# Console (can disable for production)
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y
